<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD con Firebase y Bootstrap</title>

    <!-- Agregar las referencias a Bootstrap CSS y JS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>
<body>
    <header class="cabecera">
        <section id="texto1" >
            <div class="contenedor">
                <a href="index.html" title="Pagina de inicio">
                   <img class="logo" src="img/logo.jpg" alt="Technologia inovando en el mundo">
                </a>
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <div class="container-fluid">
                        <a class="navbar-brand" href="#">Menú</a>
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarNav">
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <a class="nav-link" href="inicio.html">Inicio</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="contacto.html">Contactos</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="servicios.html">Servicios</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="ubicacion.html">Ubicación</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="galeria.html">Galeria</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
        </section>
    </header>
    
    <div class="container mt-5">
        <h1 class="mb-4">Hola Mundo</h1>
        
        <form id="crud-form">
            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" class="form-control">
            <label for="plataforma">Plataforma:</label>
            <input type="text" id="plataforma" class="form-control">
            <label for="genero">Género:</label>
            <input type="text" id="genero" class="form-control">
            <label for="fechaLanzamiento">Fecha de Lanzamiento:</label>
            <input type="date" id="fechaLanzamiento" class="form-control">
            <label for="clasificacionEdad">Clasificación de Edad:</label>
            <select id="clasificacionEdad" class="form-control">
                <option value="Todos">Todos</option>
                <option value="Adolescentes">Adolescentes (13+)</option>
                <option value="Adultos">Adultos (17+)</option>
            </select>
            <button type="button" onclick="crearRegistro()" class="btn btn-primary mt-3">Crear</button>
        </form>

        <div id="registros" class="mt-4">
            <!-- Aquí se mostrarán los registros -->
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
    
        // Tu configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBB4VLEuWx4O57s4dfu9ii0BWLWJT33x58",
            authDomain: "proyectofari.firebaseapp.com",
            databaseURL: "https://proyectofari-default-rtdb.firebaseio.com",
            projectId: "proyectofari",
            storageBucket: "proyectofari.appspot.com",
            messagingSenderId: "538414020531",
            appId: "1:538414020531:web:08051bd59c98626d6a3dc6"
        };
    
        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
    
        // Referencia al nodo principal para almacenar los registros
        const juegosPCRef = ref(database, 'juegosPC');
    
        // Función para crear un nuevo registro
        window.crearRegistro = function () {
            const nombre = document.getElementById("nombre").value;
            const plataforma = document.getElementById("plataforma").value;
            const genero = document.getElementById("genero").value;
            const fechaLanzamiento = document.getElementById("fechaLanzamiento").value;
            const clasificacionEdad = document.getElementById("clasificacionEdad").value;
    
            // Push al nodo principal "juegosPC"
            push(juegosPCRef, {
                name: nombre,
                platform: plataforma,
                genre: genero,
                releaseDate: fechaLanzamiento,
                ageRating: clasificacionEdad 
            });

            // Limpiar los campos después de agregar el registro
            document.getElementById("nombre").value = "";
            document.getElementById("plataforma").value = "";
            document.getElementById("genero").value = "";
            document.getElementById("fechaLanzamiento").value = "";
            document.getElementById("clasificacionEdad").value = "Todos";
        }

        // Función para editar un registro
        window.editarRegistro = function (key) {
            const nuevoNombre = prompt("Ingrese el nuevo nombre:");
            const nuevaPlataforma = prompt("Ingrese la nueva plataforma:");
            const nuevoGenero = prompt("Ingrese el nuevo género:");
            const nuevaFechaLanzamiento = prompt("Ingrese la nueva fecha de lanzamiento:");
            const nuevaClasificacionEdad = prompt("Ingrese la nueva clasificación de edad:");

            if (nuevoNombre && nuevaPlataforma && nuevoGenero && nuevaFechaLanzamiento && nuevaClasificacionEdad) {
                // Actualizar el registro con los nuevos valores
                const registroActualizado = {
                    name: nuevoNombre,
                    platform: nuevaPlataforma,
                    genre: nuevoGenero,
                    releaseDate: nuevaFechaLanzamiento,
                    ageRating: nuevaClasificacionEdad 
                };

                juegosPCRef.child(key).update(registroActualizado);
            } else {
                alert("La edición fue cancelada o los campos están incompletos.");
            }
        }

        // Función para eliminar un registro
        window.eliminarRegistro = function (key) {
        console.log("Eliminando registro con clave:", key);

        if (confirm("¿Seguro que desea eliminar este registro?")) {
            const registroRef = ref(juegosPCRef, key);
            console.log("Referencia al registro:", registroRef);

            // Eliminar el registro utilizando la clave
            remove(registroRef)
                .then(() => {
                    console.log("Registro eliminado exitosamente.");
                })
                .catch((error) => {
                    console.error("Error al intentar eliminar el registro:", error);
                });
        }
    }
    
        // Función para mostrar los registros en la página
        function mostrarRegistros(dataSnapshot) {
            const registrosDiv = document.getElementById("registros");
            registrosDiv.innerHTML = ""; // Limpiar contenido anterior
    
            dataSnapshot.forEach((childSnapshot) => {
                const key = childSnapshot.key;
                const registro = childSnapshot.val();
    
                registrosDiv.innerHTML += `
                    <div class="card mb-3">
                        <div class="card-body">
                            <h5 class="card-title">Nombre: ${registro.name}</h5>
                            <p class="card-text">Plataforma: ${registro.platform}</p>
                            <p class="card-text">Género: ${registro.genre}</p>
                            <p class="card-text">Fecha de Lanzamiento: ${registro.releaseDate}</p>
                            <p class="card-text">Clasificación de Edad: ${registro.ageRating}</p>
                            <button type="button" onclick="editarRegistro('${key}')" class="btn btn-warning">Editar</button>
                            <button type="button" onclick="eliminarRegistro('${key}')" class="btn btn-danger">Eliminar</button>
                        </div>
                    </div>
                `;
            });
        }
    
        // Observador para actualizar la página cuando se agregan o eliminan registros
        onValue(juegosPCRef, (snapshot) => {
            mostrarRegistros(snapshot);
        });
    </script>
</body>
</html>
