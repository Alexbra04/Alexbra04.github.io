<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD con Firebase</title>
    <!-- Agrega Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body>
    <header class="cabecera">
        <section id="texto1" >
            <div class="contenedor">
                <a href="index.html" title="Pagina de inicio">
                   <img class="logo" src="img/logo.jpg" alt="Technologia inovando en el mundo">
                </a>
                <nav class="Menu2">
                    <a href="inicio.html">Incio</a>
                    <a href="contacto.html">Contactos</a>
                    <a href="servicios.html">Servicios</a>
                    <a href="ubicacion.html">Ubicación</a>
                    <a href="galeria.html">Galeria</a>                
                </nav>
            </div>
        </section>
    </header>
    
    <h1>Hola Mundo</h1>

    <ul id="lista-registros"></ul>

    <!-- Agrega Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <!-- Agrega Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js"></script>

    <script type="module">
        // Tu configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBMJsVpnbOwVOiVNbTZScZdet9qlGigDL0",
            authDomain: "conexion-8ec0d.firebaseapp.com",
            databaseURL: "https://conexion-8ec0d-default-rtdb.firebaseio.com",
            projectId: "conexion-8ec0d",
            storageBucket: "conexion-8ec0d.appspot.com",
            messagingSenderId: "679910299749",
            appId: "1:679910299749:web:9800b464879628b4850e8c"
        };
      
        // Inicializar Firebase y base de datos
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Referencia al nodo principal para almacenar los registros
        const septimoRef = ref(database, 'septimo');

        // Función para crear un nuevo registro
        window.crearRegistro = function () {
            const nombre = document.getElementById("nombre").value;
            const edad = document.getElementById("edad").value;

            // Push al nodo principal "septimo"
            push(septimoRef, {
                name: nombre,
                age: edad 
            });
        }

        // Función para mostrar los registros en la página
        function mostrarRegistros(dataSnapshot) {
            const listaRegistros = document.getElementById('lista-registros');
            listaRegistros.innerHTML = '';

            dataSnapshot.forEach((childSnapshot) => {
                const registro = childSnapshot.val();
                const li = document.createElement('li');
                li.textContent = `${registro.name}, ${registro.age} años`;

                // Botones para editar y eliminar
                const btnEditar = document.createElement('button');
                btnEditar.textContent = 'Editar';
                btnEditar.addEventListener('click', () => editarRegistro(childSnapshot.key, registro.name, registro.age));

                const btnEliminar = document.createElement('button');
                btnEliminar.textContent = 'Eliminar';
                btnEliminar.addEventListener('click', () => eliminarRegistro(childSnapshot.key));

                li.appendChild(btnEditar);
                li.appendChild(btnEliminar);

                listaRegistros.appendChild(li);
            });
        }

        // Observador para actualizar la página cuando se agregan o eliminan registros
        onValue(septimoRef, (snapshot) => {
            mostrarRegistros(snapshot);
        });

        window.editarRegistro = function (key, nombre, edad) {
            const nuevoNombre = prompt('Editar nombre:', nombre);
            const nuevaEdad = prompt('Editar edad:', edad);

            if (nuevoNombre !== null && nuevaEdad !== null) {
                update(ref(septimoRef, key), {
                    name: nuevoNombre,
                    age: nuevaEdad
                });
            }
        }

        window.eliminarRegistro = function (key) {
            const confirmacion = confirm('¿Seguro que desea eliminar este registro?');

            if (confirmacion) {
                remove(ref(septimoRef, key));
            }
        }
    </script>
</body>
</html>
